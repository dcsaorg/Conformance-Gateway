<app-text-waiting *ngIf="isLoading && !sandbox" text="Retrieving sandbox metadata..."></app-text-waiting>

<div *ngIf="sandbox">
    <div class="pageTitle">
        <span>Sandbox: {{sandbox.name}}</span>

        <span style="vertical-align: middle;">
            <button
            mat-icon-button
            color="primary"
            title="Settings"
            (click)="onClickSettings()"
            ><mat-icon>settings</mat-icon></button>
        </span>
    </div>
    <div class="paragraph">
        <app-sandbox-type [sandbox]="sandbox"></app-sandbox-type>
    </div>
</div>

<app-text-waiting *ngIf="isLoading && sandbox && !sandbox.canNotifyParty" text="Retrieving scenarios..."></app-text-waiting>

<div class="pageSubtitle" *ngIf="!isLoading && standardModules.length == 0">No scenarios</div>

<app-text-waiting *ngIf="startingOrStoppingScenario" text="Updating scenario state..."></app-text-waiting>

<div *ngIf="!isInternalSandbox()">
    <br />
    <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
        <mat-tab label="‚ñ∂Ô∏è Scenarios">
            <div *ngIf="!startingOrStoppingScenario">
                <div *ngFor="let standardModule of standardModules">
                    <div class="pageSubtitle">{{standardModule.moduleName}}</div>

                    <mat-card [ngClass]="'entityCard'" *ngFor="let scenario of standardModule.scenarios">
                        <div class="cardContent withPointerCursor" (click)="onScenarioClick(scenario)">
                            <button
                            class="scenarioActionButton"
                            mat-icon-button
                            color="primary"
                            [disabled]="cannotPerformAction(scenario)"
                            [title]="getActionTitle(scenario)"
                            (click)="onScenarioAction($event, scenario)"
                            ><mat-icon>{{getActionIconName(scenario)}}</mat-icon></button>

                            <span
                            id="conformanceStatus"
                            class="conformanceStatus"
                            [title]="getConformanceStatusTitle(scenario.conformanceStatus)"
                            >{{getConformanceStatusEmoji(scenario.conformanceStatus)}}</span>

                            <span class="wrappingText">{{scenario.name}}</span>
                        </div>
                    </mat-card>
                    <br/>
                </div>
            </div>
        </mat-tab>
        <mat-tab label="üìú Reports">
            <div *ngIf="!displayedReportDigest">
                <div class="paragraph">Create a report from the current sandbox state:</div>
                <br/>
                <mat-form-field class="fullWidth">
                    <mat-label>Optional report title</mat-label>
                    <input
                      matInput
                      type="text"
                      autocomplete="off"
                      name="newReportTitleTextField"
                      [(ngModel)]="newReportTitle"
                    />
                </mat-form-field>
                <div>
                    <button
                    mat-raised-button
                    color="primary"
                    (click)="onClickCreateReport()"
                    >Create report</button>
                </div>

                <mat-card [ngClass]="'entityCard'" *ngFor="let reportDigest of reportDigests">
                    <div class="cardContent withPointerCursor" (click)="onReportClick(reportDigest)">
                      <span style="margin: 8px" class="wrappingText">üìú {{reportDigest.dateTime}} {{reportDigest.title}}</span>
                    </div>
                </mat-card>
            </div>

            <div *ngIf="displayedReportDigest">
                <div class="paragraph withPointerCursor">
                  <a (click)="onClickBackToAllReports()">‚¨ÖÔ∏è Back to all reports</a>
                </div>

                <app-report
                *ngIf="displayedReportContent"
                [unfoldedLevels]="2"
                [report]="displayedReportContent"
                ></app-report>
            </div>

            <br />
        </mat-tab>
    </mat-tab-group>
</div>

<div *ngIf="isInternalSandbox()">
    <div class="paragraph">
        <button
        id="notifyPartyButton"
        mat-raised-button
        color="primary"
        (click)="onClickNotifyParty()"
        >Notify party</button>
        &nbsp;
        <button
          testId="resetPartyButton"
        mat-raised-button
        (click)="onClickResetParty()"
        >Reset party</button>
    </div>

    <div class="pageSubtitle">Activity</div>
    <div>(latest message at the top)</div>
    <div class="paragraph">
        <button
        mat-raised-button
        testId="refreshButton"
        color="primary"
        (click)="onClickRefresh()"
        >Refresh</button>
    </div>
    <div class="paragraph" testId="operatorLog" *ngFor="let logEntry of sandbox?.operatorLog">{{logEntry}}</div>
</div>
